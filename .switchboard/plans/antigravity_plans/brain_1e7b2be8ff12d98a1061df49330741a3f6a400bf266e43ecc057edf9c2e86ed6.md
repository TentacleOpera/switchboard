# Implementation Plan: Improve Plan Recovery Titles

The "Recover Plans" sidebar currently displays many plans as "(untitled)". This is because the backend defaults to this string when the registry topic is missing or empty. This plan improves the display by providing descriptive fallbacks based on filenames and ensures better topic extraction.

## Proposed Changes

### Backend: `TaskViewerProvider.ts` [MODIFY]

#### [TaskViewerProvider.ts](file:///c:/Users/patvu/Documents/GitHub/switchboard/src/services/TaskViewerProvider.ts)

- Refine title extraction logic used in `_mirrorBrainPlan`, `_handlePlanCreation`, and `_handlePlanTitleSync`:
    - **Clean H1**: If the H1 starts with boilerplate prefixes like `Implementation Plan:`, `Plan:`, or `Goal Description:`, strip them to reveal the actual subject.
    - **Filename Fallback**: if the H1 is missing or results in a generic string (like just "Implementation Plan"), extract the topic from the filename:
        - Strip common prefixes (`brain_`, `feature_plan_`).
        - Remove unique hashes/IDs (e.g., `brain_d3e7b8...` -> `brain`).
        - Replace underscores/hyphens with spaces and Title Case the result.
- Update `_getRecoverablePlans` to apply this same cleaning and fallback logic to existing registry entries, ensuring the "Recover Plans" view is immediately improved.

### Frontend: `implementation.html` [MODIFY]

#### [implementation.html](file:///c:/Users/patvu/Documents/GitHub/switchboard/src/webview/implementation.html)

- Update `renderRecoverablePlans` (JS) to ensure it uses the backend-provided topic.
- Add a secondary fallback in the frontend just in case the backend topic is still missing, using similar logic (though backend should be the primary source).

---

## Verification Plan

### Automated Tests
Run the existing recovery regression tests to ensure no breakage:
```bash
npm test src/test/plan-recovery-regression.test.js
```

### Manual Verification
1. Create a plan without an H1 header (e.g., `feature_plan_test_fix.md`).
2. Mark it as complete or delete it (if it's a brain plan) to move it to the recovery list.
3. Open the "Recover Plans" modal.
4. **Verify** that the title shows "Test Fix" or similar, instead of "(untitled)".
5. Restore the plan and verify it remains active with the descriptive title.
ll missing, using similar logic (though backend should be the primary source).

---

## Verification Plan

### Automated Tests
Run the existing recovery regression tests to ensure no breakage:
```bash
npm test src/test/plan-recovery-regression.test.js
```

### Manual Verification
1. Create a plan without an H1 header (e.g., `feature_plan_test_fix.md`).
2. Mark it as complete or delete it (if it's a brain plan) to move it to the recovery list.
3. Open the "Recover Plans" modal.
4. **Verify** that the title shows "Test Fix" or similar, instead of "(untitled)".
5. Restore the plan and verify it remains active with the descriptive title.
