# Sidebar Onboarding Flow Implementation Plan

This plan outlines the replacement of the current VS Code toast warning for missing scaffolding with a dedicated "Onboarding/Setup" view in the sidebar.

## Proposed Changes

### Extension Core

#### [MODIFY] [extension.ts](file:///c:/Users/patvu/Documents/GitHub/switchboard/src/extension.ts)
- Suppress the `vscode.window.showInformationMessage` toast that appears when `needsSetup` is true during activation.
- Ensure the `switchboard.setup` command (and any underlying logic it uses, like [performSetup](file:///c:/Users/patvu/Documents/GitHub/switchboard/src/extension.ts#1707-1807) and [configureCliAgents](file:///c:/Users/patvu/Documents/GitHub/switchboard/src/extension.ts#2076-2128)) is accessible via the [TaskViewerProvider](file:///c:/Users/patvu/Documents/GitHub/switchboard/src/services/TaskViewerProvider.ts#55-5572).

### Sidebar Service

#### [MODIFY] [TaskViewerProvider.ts](file:///c:/Users/patvu/Documents/GitHub/switchboard/src/services/TaskViewerProvider.ts)
- Update [sendInitialState](file:///c:/Users/patvu/Documents/GitHub/switchboard/src/services/TaskViewerProvider.ts#507-521) to explicitly include the `needsSetup` status.
- Add new message handlers:
    - `initializeProtocols`: Triggers the core scaffolding setup (calling [performSetup](file:///c:/Users/patvu/Documents/GitHub/switchboard/src/extension.ts#1707-1807) or equivalent logic from [extension.ts](file:///c:/Users/patvu/Documents/GitHub/switchboard/src/extension.ts)).
    - `saveCliAgents`: Receives a batch of CLI agent commands and updates the workspace configuration (replacing the one-by-one `showInputBox` flow).
    - `finishOnboarding`: Refreshes the `needsSetup` state and switches the UI to the normal agent list.

### Sidebar Webview

#### [MODIFY] [implementation.html](file:///c:/Users/patvu/Documents/GitHub/switchboard/src/webview/implementation.html)
- **New Container**: Add an `#onboarding-container` that is shown when `needsSetup` is true.
- **Onboarding View 1 (Initialize)**:
    - Simple "Welcome to Switchboard" screen.
    - "Initialize Switchboard" button.
- **Onboarding View 2 (CLI Config)**:
    - Shown after initialization.
    - A list of input fields for each role: Lead, Coder, Analyst, Reviewer.
    - "Save and Finish" button.
- **Logic**: Use the `initialState` message to toggle between `#onboarding-container` and the existing `#main-container`.

## Verification Plan

### Automated Tests
- No new automated tests are planned for this UI-heavy change, but existing [extension.test.ts](file:///c:/Users/patvu/Documents/GitHub/switchboard/src/test/extension.test.ts) will be run to ensure no regressions in extension activation.
- `npm run test` (Note: Need to confirm exact test command from `package.json`).

### Manual Verification
1.  **Fresh Workspace**: Open a new folder without Switchboard scaffolding.
2.  **Sidebar Check**: Verify the sidebar shows the onboarding welcome screen instead of the agent list.
3.  **Toast Suppression**: Verify no VS Code toast notification appears about missing scaffolding.
4.  **Initialization**: Click "Initialize Switchboard" and verify the `.agent` and `.switchboard` directories are created.
5.  **CLI Config**: Verify the UI switches to the CLI configuration list.
6.  **Batch Save**: Enter various CLI commands (e.g., `claude`, `aider`) in the fields and click "Save and Finish".
7.  **Final State**: Verify the sidebar now shows the normal agent list and the CLI commands are correctly persisted in [.vscode/settings.json](file:///c:/Users/patvu/Documents/GitHub/switchboard/.vscode/settings.json).
